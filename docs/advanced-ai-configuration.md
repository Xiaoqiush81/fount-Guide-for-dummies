# ËøõÈò∂ AI Ê∫êÈÖçÁΩÆÊâãÂÜå

Êú¨ÊâãÂÜåÊòØ [Âü∫Á°ÄÈÖçÁΩÆ](./configuration.md) ÁöÑËøõÈò∂ÁØáÔºåËØ¶ÁªÜ‰ªãÁªç‰∫Ü fount ‰∏≠ÊâÄÊúâÁâπÊÆä AI Ê∫êÁöÑÈÖçÁΩÆÂèÇÊï∞„ÄÅËøêË°åÈÄªËæë‰ª•ÂèäÂÆûÊàò JSON ËåÉ‰æã„ÄÇ
Â¶ÇÊûú‰Ω†ÈúÄË¶ÅÂÆûÁé∞Ë¥üËΩΩÂùáË°°„ÄÅÊïÖÈöúËΩ¨Áßª„ÄÅÊù°‰ª∂Ë∑ØÁî±ÊàñÁªìÊûúÂêéÂ§ÑÁêÜÔºåËØ∑‰ªîÁªÜÈòÖËØª‰ª•‰∏ãÂÜÖÂÆπ„ÄÇ

---

## üõ†Ô∏è 1. Á®≥ÂÆöÊÄßË∞ÉÂ∫¶Á±ª

### 1.1 ËΩÆËØ¢ (Polling) ‚Äî‚Äî Ë¥üËΩΩÂùáË°°‰∏éËá™Âä®ÈáçËØï
**Âú∫ÊôØ**ÔºöÊã•ÊúâÂ§ö‰∏™ KeyÔºåÂ∏åÊúõÂÆûÁé∞ÂùáË°°Ë¥üËΩΩÔºõÊàñÂΩì‰∏Ä‰∏™ Key È¢ùÂ∫¶ËÄóÂ∞Ω/Êä•ÈîôÊó∂Ëá™Âä®ÂàáÊç¢Âà∞‰∏ã‰∏Ä‰∏™„ÄÇ

| ÂèÇÊï∞Âêç | Á±ªÂûã | ËØ¥Êòé | ÈªòËÆ§ÂÄº |
| :--- | :--- | :--- | :--- |
| `sources` | Array | Ê∫êÂàóË°®ÔºàÊîØÊåÅÊ∫êÂêçÂ≠óÁ¨¶‰∏≤ÊàñÈÖçÁΩÆÂØπË±°Ôºâ„ÄÇ | **ÂøÖÂ°´** |
| `random_start` | Boolean | ÊòØÂê¶ÈöèÊú∫ÈÄâÊã©Ëµ∑ÂßãÁ¥¢Âºï„ÄÇÂºÄÂêØÂêéÊØèÊ¨°ÂêØÂä®Êó∂ÁöÑÈ¶ñÈÄâÊ∫ê‰∏çÂêå„ÄÇ | `true` |
| `max_fail_count` | Number | **ÈáçËØïÊú∫Âà∂**ÔºöÂçïÊ¨°ËØ∑Ê±ÇÊúÄÂ§öÈáçËØïÊ¨°Êï∞„ÄÇËã•‰∏çÂ°´Ôºå‰∏îÂ≠êÊ∫êÁ±ªÂûãÁõ∏ÂêåÈªòËÆ§ 3 Ê¨°ÔºåÁ±ªÂûãÊ∑∑ÊùÇÂàôÈªòËÆ§ ‚àû„ÄÇÊúÄÁªàÂèñ `Math.min(ÂàóË°®ÈïøÂ∫¶, ÈÖçÁΩÆÂÄº)`„ÄÇ | Ëá™Âä® |
| `dead_sources` | Array | **ÊåÅ‰πÖÂåñÁª¥Êä§**ÔºöÂ≠òÊîæÂ∑≤Ë¢´Ê£ÄÊµã‰∏∫Â§±ÊïàÔºàsource_deadÔºâÁöÑÈ°π„ÄÇÁ≥ªÁªü‰ºöËá™Âä®ÊâßË°å `SaveConfig()` Â∞ÜÂÖ∂ÁßªÂÖ•Ê≠§ÂàóÂπ∂ÊåÅ‰πÖÂåñ„ÄÇ | `[]` |

**„ÄêÂç≥ÊèíÂç≥Áî®ËåÉ‰æã„Äë**
```json
{
  "name": "GeminiË¥üËΩΩÂùáË°°ÁªÑ",
  "generator": "polling",
  "config": {
    "sources": ["Gemini-Key1", "Gemini-Key2", "Gemini-Key3"],
    "random_start": true,
    "max_fail_count": 5
  }
}
```

---

### 1.2 Â§áÁî® (Fallback) ‚Äî‚Äî ‰ºòÂÖàÁ∫ßÊïÖÈöúËΩ¨Áßª
**Âú∫ÊôØ**Ôºö‰∏ªÊ®°ÂûãÔºàÂ¶Ç Claude-3-OpusÔºâÊòÇË¥µ‰ΩÜÊïàÊûúÂ•ΩÔºåÂ§áÁî®Ê®°ÂûãÔºàÂ¶Ç HaikuÔºâ‰æøÂÆú„ÄÇÂ∏åÊúõ‰ºòÂÖàÁî®‰∏ªÊ®°ÂûãÔºå‰ªÖÂΩì‰∏ªÊ®°ÂûãÊåÇÊéâÊó∂ÊâçÁî®Â§áÁî®Ê®°Âûã„ÄÇ

| ÂèÇÊï∞Âêç | Á±ªÂûã | ËØ¥Êòé | ÈªòËÆ§ÂÄº |
| :--- | :--- | :--- | :--- |
| `sources` | Array | Êåâ**‰ºòÂÖàÁ∫ß‰ªéÈ´òÂà∞‰Ωé**ÊéíÂ∫èÁöÑÊ∫êÂàóË°®„ÄÇ | **ÂøÖÂ°´** |

**„ÄêÂç≥ÊèíÂç≥Áî®ËåÉ‰æã„Äë**
```json
{
  "name": "‰∏ªÂäõÈò≤Âæ°Â∏¶Â§áÁî®",
  "generator": "fallback",
  "config": {
    "sources": ["Claude-3.5-Opus", "Claude-3-Haiku"]
  }
}
```

---

## üß† 2. Êô∫ËÉΩÂåñÂàÜÊµÅÁ±ª

### 2.1 Êù°‰ª∂Ë∑ØÁî± (If-Else) ‚Äî‚Äî ÈÄªËæëÂ§ßËÑë
**Âú∫ÊôØ**ÔºöÊ†πÊçÆÊ∂àÊÅØÂÜÖÂÆπÔºàÂ¶ÇÊòØÂê¶ÂåÖÂê´ÂõæÁâá„ÄÅÁâπÂÆöÂÖ≥ÈîÆËØçÔºâÂä®ÊÄÅÂÜ≥ÂÆö‰ΩøÁî®Âì™‰∏™Ê®°ÂûãÔºõÊàñÂØπ AI ÂõûÂ§çËøõË°åÂêéÁΩÆÂÆ°ËÆ°ÔºàÂ¶ÇÂÜÖÂÆπÂ§™Áü≠ÂàôÈáçËØïÔºâ„ÄÇ

| ËßÑÂàôÁ±ªÂûã | ÂèÇÊï∞ | ËØ¥Êòé |
| :--- | :--- | :--- |
| **`if` Á±ªÂûã** | `condition` | JS Ë°®ËææÂºè„ÄÇ**ÂèòÈáèÁéØÂ¢É**Ôºö`content` (ÂΩìÂâçÊãºÊé•ÊñáÊú¨), `chat_log` (ÂéÜÂè≤Ê∂àÊÅØÊï∞ÁªÑ), `prompt_struct` (ÂéüÂßã Prompt ÁªìÊûÑ)„ÄÇ |
| | `target` | ÂåπÈÖçÊàêÂäüÂêéËΩ¨ÂêëÁöÑÊ∫êÂêçÁß∞„ÄÇ |
| **`if_result`** | `condition` | JS Ë°®ËææÂºè„ÄÇ**ÂèòÈáèÁéØÂ¢É**Ôºö`result.content` (‰∏ä‰∏ÄÊ≠•ÁîüÊàêÁöÑÂõûÂ§çÂÜÖÂÆπ)„ÄÇ |
| | `execute` | **ÊâßË°åÈìæ**ÔºöÂ§öÊù°ËßÑÂàôÈ°∫Â∫èÊâßË°å„ÄÇÂâçËÄÖÁöÑÁªìÊûú‰Ωú‰∏∫ÂêéËÄÖÁöÑ `result` ËæìÂÖ•„ÄÇÂèØÊâßË°å `throw` ÊäõÂá∫ÈîôËØØ‰ª•Ëß¶ÂèëÈáçËØï„ÄÇ |

**„ÄêÈ´òÈò∂ÂÆûÊàòËåÉ‰æãÔºöËßÜËßâËØÜÂà´ + ÂÖ≥ÈîÆËØçÂàÜÊµÅ + Èò≤ÂëÜÈáçËØï„Äë**
```json
{
  "name": "Êô∫ËÉΩÂàÜÊµÅÂô®",
  "generator": "ifelse",
  "config": {
    "rules": [
      {
        "type": "if",
        "condition": "chat_log.some(m => m.files?.length)",
        "target": "GPT-4-Vision"
      },
      {
        "type": "if",
        "condition": "content.includes('ÂÜô‰ª£Á†Å')",
        "target": "Claude-3.5-Sonnet"
      },
      {
        "type": "if_result",
        "condition": "result.content.includes('Êä±Ê≠â') || result.content.length < 5",
        "execute": "throw new Error('AIÊäΩÈ£é‰∫ÜÔºåÊ≠£Âú®ÈáçÂÜô...')"
      },
      { "type": "if", "condition": "true", "target": "ÈªòËÆ§Ê®°Âûã" }
    ]
  }
}
```

#### üí° ËøõÈò∂ÊäÄÂ∑ßÔºöÈáçËØïÁéÑÂ≠¶ (Polling + If-Else)
Ë¶ÅÊÉ≥ÂÆûÁé∞‚ÄúAI ËØ¥ËØù‰∏çÂ•ΩÂ∞±Êç¢Âè∑ÈáçÂÜô‚ÄùÔºåÈúÄÂ∞Ü `If-Else` ÊîæÂÖ• `Polling` ÁöÑ `sources` ÂàóË°®‰∏≠„ÄÇ
1. `If-Else` ÈÄöËøá `if_result` Ê£ÄÊü•ÂõûÂ§çË¥®Èáè„ÄÇ
2. Ëã•Ë¥®Èáè‰∏ç‰Ω≥ÔºåÊâßË°å `throw new Error()`„ÄÇ
3. ÈîôËØØË¢´Â§ñÂ±Ç `Polling` ÊçïËé∑ÔºåËá™Âä®ÂàáÊç¢Âà∞‰∏ã‰∏Ä‰∏™Ê∫êÈáçËØï„ÄÇ

---

## üé≠ 3. Ë£ÖÈ•∞‰∏éÂåÖË£ÖÁ±ª

### 3.1 Êõ¥ÊîπÊèêÁ§∫ (Change Prompt)
**Âú∫ÊôØ**ÔºöÂº∫Ë°åÊ≥®ÂÖ• System PromptÔºå‰øÆÊîπÁî®Êà∑ËæìÂÖ•ÔºåÊàñËÄÖÂØπ AI ÁªìÊûúËøõË°åÊ≠£ÂàôÊõøÊç¢ÔºàËÑ±Êïè/Ê†ºÂºèÂåñÔºâ„ÄÇ

| ÂèÇÊï∞Âêç | Á±ªÂûã | ËØ¥Êòé | ÈªòËÆ§ÂÄº |
| :--- | :--- | :--- | :--- |
| `base_source` | String | Ë¢´ÂåÖË£ÖÁöÑÂ∫ïÂ±ÇÊ∫êÂêçÁß∞„ÄÇ | **ÂøÖÂ°´** |
| `build_prompt` | Boolean | **ËÅöÂêàÊéíÂ∫è**ÔºöÂºÄÂêØÂêéÔºåÁ≥ªÁªü‰ºöÈÅçÂéÜÂêÑÈÉ®ÂàÜÁ¢éÁâáÂπ∂Êåâ `important` ÊùÉÈáç**‰ªéÂ∞èÂà∞Â§ßÔºàÂçáÂ∫èÔºâ**ÊéíÂ∫èÂêéÊãºÊé•‰∏∫Á∫ØÊñáÊú¨„ÄÇ | `false` |
| `changes` | Array | **ÊèíÂÖ•/‰øÆÊîπ**ÔºöÂåÖÂê´ `insert_depth` Âíå `content`„ÄÇÊ≠£Êï∞‰ªéÂêéÂæÄÂâçÊï∞ÔºåÈùûÊ≠£Êï∞ÔºàÂê´0ÔºâÁªùÂØπÁ¥¢ÂºïÔºå`-999` Âõ∫ÂÆöËøΩÂä†„ÄÇ | `[]` |
| `replaces` | Array | **Ê≠£ÂàôÊõøÊç¢**ÔºöÂåÖÂê´ `seek` (Ê†ºÂºèÔºö`/pattern/flags`) Âíå `replace` (ÊîØÊåÅ `$1` Á≠âÊçïËé∑ÁªÑ)„ÄÇ | `[]` |

**„ÄêÂÖ®ÂäüËÉΩËåÉ‰æãÔºöËßíËâ≤ÊâÆÊºîÂº∫Êåá‰ª§ÂåÖË£ÖÂô®„Äë**
```json
{
  "name": "Á°¨ËßÑÂàôÂåÖË£ÖÂô®",
  "generator": "change-prompt",
  "config": {
    "base_source": "Â∫ïÂ±ÇÂ§ßÊ®°Âûã",
    "build_prompt": true,
    "changes": [
      {
        "insert_depth": 1,
        "content": {
          "role": "system",
          "content": "„ÄêÊ†∏ÂøÉÊåá‰ª§„Äë‰Ω†ÊòØ ${Charname}„ÄÇËÆæÂÆöÂ¶Ç‰∏ãÔºö\n${char_prompt}"
        }
      }
    ],
    "replaces": [
      { "seek": "/(AI|Êú∫Âô®‰∫∫)/g", "replace": "Âä©Êâã" },
      { "seek": "/\\((.*?)\\)/g", "replace": "[$1]" }
    ]
  }
}
```

#### üí° `${...}` ÂèòÈáèÊ∏ÖÂçï (ÈúÄÂºÄÂêØ `build_prompt: true`)
- **`${Charname}` / `${UserCharname}`**: ËßíËâ≤/Áé©ÂÆ∂ÂêçÁß∞„ÄÇ
- **`${char_prompt}` / `${user_prompt}` / `${world_prompt}`**: Â∑≤ÊåâÊùÉÈáçÊéíÂ∫èÁöÑËÆæÂÆöÂÖ®ÊñáÊú¨„ÄÇ
- **`${other_chars_prompts}` / `${plugin_prompts}`**: ËÅöÂêàÂêéÁöÑÂú∫ÊôØÂÖ∂‰ªñËßíËâ≤‰∏éÊèí‰ª∂Êåá‰ª§„ÄÇ
- **`${chat_log}`**: ÂÆåÊï¥ÁöÑÂéÜÂè≤‰∏ä‰∏ãÊñá„ÄÇ

---

## üìä 4. ËæÖÂä©Â∑•ÂÖ∑Á±ª

### 4.1 Âä†ÊùÉÈöèÊú∫ (Random)
**Âú∫ÊôØ**ÔºöÊäΩÂç°ÂºèÊ®°ÂûãÈÄâÊã©Ôºå‰æãÂ¶Ç 70% Ê¶ÇÁéáËµ∞ A Ê®°ÂûãÔºå30% Ê¶ÇÁéáËµ∞ B Ê®°Âûã„ÄÇ

| ÂèÇÊï∞Âêç | Á±ªÂûã | ËØ¥Êòé |
| :--- | :--- | :--- |
| `sources` | Array | ÂåÖÂê´ `weight` (ÊùÉÈáç) Âíå `source` (Ê∫êÂêç) ÁöÑÂØπË±°Êï∞ÁªÑ„ÄÇ |

**„ÄêÂç≥ÊèíÂç≥Áî®ËåÉ‰æã„Äë**
```json
{
  "generator": "random",
  "config": {
    "sources": [
      { "weight": 7, "source": "Ê®°Âûã-A" },
      { "weight": 3, "source": "Ê®°Âûã-B" }
    ]
  }
}
```

### 4.2 Â§öÈáçÊØîËæÉ (Multi-Compare)
**Âú∫ÊôØ**ÔºöÂêåÊó∂ÂêëÂ§ö‰∏™Ê®°ÂûãÂèëÈÄÅËØ∑Ê±ÇÔºåÂêàÂπ∂Âπ∂ÂØπÊØîÂÆÉ‰ª¨ÁöÑÂõûÂ§ç„ÄÇÈÄÇÂêàÊ®°ÂûãÁ´ûÊäÄÂú∫ÊàñË¥®ÈáèËØÑ‰º∞„ÄÇ

```json
{
  "generator": "multi-compare",
  "config": {
    "sources": ["GPT-4o", "Claude-3.5", "Gemini-1.5-Pro"]
  }
}
```

#### üí° ËøêË°åÈÄªËæë
`multi-compare` ‰ºö**Âπ∂Ë°å**Âêë `sources` ÂàóË°®‰∏≠ÁöÑÊâÄÊúâÊ∫êÂèëÈÄÅËØ∑Ê±Ç„ÄÇÂÆÉ‰ºöÁ≠âÂæÖÊâÄÊúâËØ∑Ê±ÇÂÆåÊàêÂêéÔºåÂ∞ÜÁªìÊûúÊ±áÊÄªËøîÂõû„ÄÇ
**ËøîÂõûÊ†ºÂºè**Ôºö`**[Ê∫êÂêçÁß∞] from [‰æõÂ∫îÂïÜÂêçÁß∞]:**\n[ÂõûÂ§çÂÜÖÂÆπ]`

---

## üéì 5. È´òÈò∂ÂéüÁêÜ‰∏éÂºÄÂèëËÄÖÂèÇËÄÉ

### 5.1 ÂºÇÊ≠•ËØÑ‰º∞Âô® `async_eval`
ÊâÄÊúâÁöÑ `condition` Âíå `${...}` Ë°®ËææÂºèÈÉΩÊòØÈÄöËøá `async_eval` Â§ÑÁêÜÁöÑ„ÄÇËøôÊÑèÂë≥ÁùÄ‰Ω†ÂèØ‰ª•Âú®Ë°®ËææÂºèÈáåÂÜô‰ªª‰ΩïÂêàÊ≥ïÁöÑ JS ÈÄªËæëÔºåÁîöËá≥Ë∞ÉÁî® `Array.prototype` ÁöÑÊñπÊ≥ï„ÄÇ

### 5.2 ÁîüÂëΩÂë®Êúü‰∏éÈÄíÂΩí
- **Êó†ÈôêÂ•óÂ®É**ÔºöÈÄöËøá `loadAIsourceFromNameOrConfigData`Ôºå‰Ω†ÂèØ‰ª•ÂÆûÁé∞‚ÄúPolling ÈáåÈù¢Â•ó If-ElseÔºåIf-Else ÈáåÈù¢Â•ó Change Prompt‚ÄùÁöÑÂ§çÊùÇÈÄªËæë„ÄÇ
- **ÊâßË°åÊµÅ**Ôºö
  1. Ëé∑ÂèñÈùôÊÄÅ/Âä®ÊÄÅ‰ø°ÊÅØ
  2. ÈÄíÂΩíÂ≠êÊ∫êÂàùÂßãÂåñ
  3. ÂâçÁΩÆÂ§ÑÁêÜ (`if` Ë∑ØÁî± / `changes` ÂåÖË£Ö)
  4. ÂêëÂ∫ïÂ±ÇÂèëÈÄÅËØ∑Ê±Ç
  5. ÂêéÁΩÆÂ§ÑÁêÜ (`if_result` ÂÆ°ËÆ° / `replaces` ËøáÊª§)
  6. Ê±áÊÄªËøîÂõû

---

[< ‰∏ä‰∏ÄÈ°µÔºöÂü∫Á°ÄÈÖçÁΩÆ (Configuration)](./configuration.md) | [ËøîÂõûÁõÆÂΩï](../README.md) | [‰∏ã‰∏ÄÈ°µÔºöÂØºÂÖ•ËßíËâ≤ (Import Character) >](./import-char.md)
